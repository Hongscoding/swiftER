<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/member/member.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../img/swifter_logo_head.png">
    <title>ID 찾기</title>
    <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script>
	$(document).ready(function(){
		let isEmailOk = false;
		$('#findPwEmailCheck').click(function(){
			let email = $('input[name=email]').val();
			
			$.ajax({
				url : '/swiftER/member/checkEmail',
   				method : 'get',
   				data : {"email":email},
   				dataType : 'json',
   				success : function(data){
   					console.log(email);
   				}
			});
		});
		
		$('#findPwCheckCode').click(function(){
			let code = $('input[name=code]').val();
			
			$.ajax({
				url : '/swiftER/member/checkCode',
				method : 'get',
				data : {"code":code},
				dataType : 'json',
				success : function(data){
					
					console.log('data : ' + data);
					
					if(data.result != 0){
						$('.resultCode').css('color', 'red').text('잘못된 인증번호입니다');
						console.log(data.result);
					}else{
						$('.resultCode').css('color', 'green').text('인증 되었습니다');
						$('input[name=code]').attr('readonly', true);
						isEmailOk = true;
						console.log(data.result);
					}
				}
				
			})
		});
		
		$('#findPwSubmit').click(function(){
			// 이메일 검증
    		if(!isEmailOk){
    			alert('이메일 인증을 진행해야합니다.');
    			return false;
    		}else{
    			let name = $('input[name=name]').val();
    			let email = $('input[name=email]').val();
    			
    			let jsonData = {
    					"name": name,
    					"email": email
    					};
    			
    			console.log(jsonData);
    			
    			$.ajax({
    				url : '/swiftER/member/findId',
       				type : 'post',
       				data : jsonData,
       				dataType : 'json',
       				success : function(data){
       					if(data.vo != null){
       						location.href="/swiftER/member/findIdResult";
       					}else{
       						alert('해당하는 사용자가 존재하지 않습니다.\n이름과 이메일을 다시 확인하십시오.');
       					}
       				}
    			});
    		}
		});
		
	});
	
	</script>
</head>
<body>
    <div id="wrapper">
        <header>
        <p class="p_Header">
			<a sec:authorize="!isAuthenticated()" th:href="@{/member/login}">로그인</a>
			<a sec:authorize="!isAuthenticated()" th:href="@{/member/terms}">회원가입</a>
			<a sec:authorize="isAuthenticated()" th:href="@{/member/logout}" class="logout">로그아웃</a>
			<a sec:authorize="isAuthenticated()" th:href="@{/member/myPage}">마이페이지</a>
       	</p>
            <div class="centerName">
                <div><img th:src="@{/img/member/swifter_logo.png}" alt="로고" width="200px" height="200px" class="logo">
                </div>
                <div>
                    <h1>
                        
                        swiftER <br> ID 찾기
                    </h1>
                </div> 
            </div>
        </header>
        <main>
            <h2>
                <a th:href="@{/}" class="home"><img th:src="@{/img/member/home.png}" alt="홈으로" width="50px" height="50px"></a>
            </h2>
            <article class="findId">
                <section>
                    <h4 class="find">아래의 정보를 입력하여 swiftER ID를 찾으십시오</h4>
                    <table>
                        <tr>
                            <th>
                                이름
                            </th>
                            <td>
                                <input type="text" name="name" placeholder="이름 입력">
                                <span>이름을 입력하여 주십시오</span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                E-mail
                            </th>
                            <td>
                                <input type="text" name="email" placeholder="E-mail 입력">
                                <span class="chkEmail"><button id="findPwEmailCheck">인증번호 전송</button></span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                인증번호
                            </th>
                            <td>
                                <input type="text" name="code" placeholder="인증번호">
                                <span class="resultCode"><button id="findPwCheckCode">인증번호 확인</button>&nbsp;&nbsp;&nbsp;전송받은 인증번호를 입력해 주십시오</span>
                            </td>
                        </tr>
                    </table>
                    <div class="find">
                        <span>
                            <a th:href="@{/member/login}">로그인</a>
                            |
                            <a th:href="@{/member/findPw}">비밀번호 찾기</a>
                            |
                            <a th:href="@{/member/terms}">회원가입</a>
                        </span>
                    </div>
                </section>
                <div>
                    <button class="submit" id="findPwSubmit">
                        ID 찾기
                    </button>
                </div>
            </article>
        </main>
    </div>
    <footer>

    </footer>
</body>
</html>